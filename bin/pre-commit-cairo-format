#!/bin/bash
#
# Pre-commit hook for Cairo formatting - runs only on changed files
# Usage: ./bin/pre-commit-cairo-format contracts/src/file1.cairo contracts/src/file2.cairo ...
#
set -euo pipefail

# Exit early if no files provided
if [ $# -eq 0 ]; then
    echo "No Cairo files to format"
    exit 0
fi

echo "‚ú® Running Cairo format on changed files..."
echo "Files: $*"

# Use the focused Cairo script for formatting
$(dirname "$0")/cairo-lint

# Check if any files were modified after formatting
MODIFIED_FILES=()
for file in "$@"; do
    if [ -f "$file" ] && ! git diff --name-only --exit-code "$file" >/dev/null 2>&1; then
        MODIFIED_FILES+=("$file")
    fi
done

if [ ${#MODIFIED_FILES[@]} -gt 0 ]; then
    echo "üìù The following files were formatted:"
    printf '%s\n' "${MODIFIED_FILES[@]}"
    echo "Please stage these changes and commit again."
    exit 1
fi

echo "‚úÖ Cairo formatting completed successfully!" 